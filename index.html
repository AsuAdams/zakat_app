<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=yes, viewport-fit=cover" />
<title>Zakat App - MKA Uganda</title>
<style>
* {
margin: 0;
padding: 0;
box-sizing: border-box;
-webkit-tap-highlight-color: transparent;
}
:root {
--bg: #728995;
--bg-light: #1a5a3a;
--accent: #031f2a;
--accent-hover: #50adbd57;
--card-bg: #f3f8f8;
--card-text: #01150e;
--muted: #6b6b6b;
--header-bg: #505148;
--scrollbar-track: #f1f1f1;
--scrollbar-thumb: #0f3b2c;
--scrollbar-thumb-hover: #1a5a3a;
--success: #2e7d32;
--error: #d32f2f;
--shadow: 0 4px 20px rgba(209, 17, 17, 0.08);
--shadow-hover: 0 8px 30px rgba(0,0,0,0.12);
--slider-track-bg: #e1e2e1;
--slider-fill-bg: #19943e;
}
/* Dynamic Scrollbar - Green only when scrolling */
::-webkit-scrollbar {
width: 6px;
height: 6px;
}
::-webkit-scrollbar-track {
background: var(--scrollbar-track);
border-radius: 10px;
}
::-webkit-scrollbar-thumb {
background: transparent;
border-radius: 10px;
transition: background 0.3s ease;
}
.scrolling-active ::-webkit-scrollbar-thumb {
background: var(--scrollbar-thumb);
}
::-webkit-scrollbar-thumb:hover {
background: var(--scrollbar-thumb-hover);
}
/* For Firefox */
* {
scrollbar-width: thin;
scrollbar-color: transparent var(--scrollbar-track);
}
.scrolling-active * {
scrollbar-color: var(--scrollbar-thumb) var(--scrollbar-track);
}
html, body {
height: 100%;
background: var(--bg);
font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
overflow-x: hidden;
}
body {
color: white;
margin: 0;
padding: 0;
padding-bottom: 85px;
min-height: 100vh;
position: relative;
}
/* Header */
.app-header {
position: fixed;
top: 0;
left: 0;
right: 0;
background: rgb(41, 85, 100);
backdrop-filter: blur(10px);
color: white;
z-index: 100;
padding: 12px 16px;
border-bottom: 1px solid rgba(244, 180, 0, 0.3);
transition: all 0.3s ease;
}
.header-content {
display: flex;
align-items: center;
justify-content: space-between;
max-width: 1200px;
margin: 0 auto;
}
.logo-mini {
display: flex;
align-items: center;
gap: 10px;
}
.logo-mini-circle {
width: 40px;
height: 40px;
background: white;
border-radius: 10px;
display: flex;
align-items: center;
justify-content: center;
box-shadow: 0 2px 10px rgba(0,0,0,0.2);
}
.logo-mini-circle svg {
width: 24px;
height: 24px;
}
.logo-mini-text {
font-size: 16px;
font-weight: 700;
color: white;
line-height: 1.2;
letter-spacing: 0.5px;
}
.logo-mini-text small {
font-size: 10px;
color: var(--accent);
display: block;
font-weight: 500;
text-transform: uppercase;
}
.page-title-badge {
background: rgba(244, 180, 0, 0.1);
padding: 6px 16px;
border-radius: 20px;
font-size: 12px;
font-weight: 600;
color: var(--accent);
border: 1px solid rgba(244, 180, 0, 0.3);
white-space: nowrap;
text-transform: uppercase;
letter-spacing: 1px;
}
.user-header-mini {
display: flex;
align-items: center;
gap: 10px;
background: rgba(255, 255, 255, 0.1);
padding: 4px 4px 4px 12px;
border-radius: 30px;
border: 1px solid rgba(244, 180, 0, 0.3);
}
.user-header-mini .name {
font-size: 13px;
font-weight: 600;
color: white;
max-width: 120px;
overflow: hidden;
text-overflow: ellipsis;
white-space: nowrap;
}
.logout-btn {
background: var(--error);
border: none;
color: white;
font-size: 11px;
font-weight: 700;
padding: 6px 12px;
border-radius: 20px;
display: flex;
align-items: center;
gap: 5px;
cursor: pointer;
min-height: 28px;
box-shadow: 0 2px 8px rgba(211, 47, 47, 0.4);
transition: transform 0.2s, background 0.2s;
}
.logout-btn svg {
width: 14px;
height: 14px;
stroke: white;
}
.logout-btn:hover {
background: #b71c1c;
transform: translateY(-1px);
}
.logout-btn:active {
transform: scale(0.95);
}
/* Container */
.container {
max-width: 800px;
margin: 0 auto;
padding: 80px 16px 100px;
position: relative;
min-height: 100vh;
overflow-y: auto;
overflow-x: hidden;
scroll-behavior: smooth;
}
/* Page Transitions */
.page {
display: none !important;
animation: fadeIn 0.4s ease-out;
}
.page.active {
display: block !important;
}
@keyframes fadeIn {
from { opacity: 0; transform: translateY(10px); }
to { opacity: 1; transform: translateY(0); }
}
/* Cards */
.card {
background: var(--card-bg);
color: var(--card-text);
border-radius: 24px;
padding: 24px;
margin-top: 20px;
box-shadow: var(--shadow);
border: 1px solid rgba(255,255,255,0.1);
transition: transform 0.2s, box-shadow 0.2s;
}
.card:hover {
box-shadow: var(--shadow-hover);
}
h2 {
font-size: 1.4rem;
margin: 0 0 16px;
color: var(--card-text);
font-weight: 700;
border-left: 5px solid var(--accent);
padding-left: 15px;
display: flex;
align-items: center;
gap: 10px;
}
h3 {
color: var(--bg);
margin: 16px 0 10px;
font-size: 1.1rem;
font-weight: 600;
}
/* Teachings Carousel */
.teachings-carousel {
position: relative;
width: 100%;
min-height: 340px;
margin: 10px 0;
border-radius: 18px;
overflow: hidden;
}
.teaching-slide {
position: absolute;
top: 0;
left: 0;
width: 100%;
height: 100%;
opacity: 0;
visibility: hidden;
transition: opacity 0.6s ease, visibility 0.6s ease;
background: linear-gradient(135deg, #f8f9fa, #ffffff);
border-radius: 18px;
padding: 24px;
border: 1px solid rgba(244, 180, 0, 0.1);
display: flex;
flex-direction: column;
justify-content: center;
}
.teaching-slide.active-slide {
opacity: 1;
visibility: visible;
position: relative;
z-index: 1;
}
.teaching-slide h3 {
display: flex;
align-items: center;
gap: 10px;
color: var(--bg);
border-bottom: 2px solid var(--accent);
padding-bottom: 12px;
margin-bottom: 15px;
margin-top: 0;
}
.teaching-slide h3 svg {
width: 24px;
height: 24px;
stroke: var(--accent);
}
.teaching-content {
font-size: 15px;
line-height: 1.7;
color: #444;
flex-grow: 1;
}
.hadith-text {
background: #fff8e1;
padding: 15px;
border-radius: 12px;
border-left: 4px solid var(--accent);
font-style: italic;
margin: 10px 0;
color: #555;
}
.reference {
font-size: 12px;
color: var(--muted);
margin-top: 15px;
text-align: right;
font-weight: 600;
text-transform: uppercase;
}
.slide-indicators {
display: flex;
justify-content: center;
gap: 8px;
margin-top: 15px;
position: relative;
z-index: 2;
}
.indicator {
width: 8px;
height: 8px;
border-radius: 4px;
background: #ddd;
transition: all 0.3s;
cursor: pointer;
}
.indicator.active {
width: 24px;
background: var(--accent);
}
.slide-timer {
width: 100%;
height: 4px;
background: #eee;
border-radius: 2px;
margin-top: 15px;
overflow: hidden;
}
.timer-bar {
height: 100%;
background: var(--accent);
width: 0%;
transition: width 0.1s linear;
}
/* Forms & Inputs */
input, select, textarea {
font-size: 16px !important;
padding: 16px;
width: 100%;
border-radius: 16px;
border: 2px solid #e0e0e0;
background: #f9f9f9;
transition: all 0.3s;
color: #333;
font-weight: 500;
}
input:focus, select:focus, textarea:focus {
outline: none;
border-color: var(--bg);
background: white;
box-shadow: 0 0 0 4px rgba(15, 59, 44, 0.1);
}
input::placeholder {
color: #aaa;
}
button {
min-height: 50px;
padding: 14px 24px;
font-size: 16px;
font-weight: 700;
border-radius: 16px;
background: var(--accent);
color: var(--bg);
border: none;
touch-action: manipulation;
cursor: pointer;
transition: all 0.2s;
box-shadow: 0 4px 15px rgba(244, 180, 0, 0.3);
display: inline-flex;
align-items: center;
justify-content: center;
gap: 8px;
}
button:hover {
background: var(--accent-hover);
transform: translateY(-2px);
box-shadow: 0 6px 20px rgba(244, 180, 0, 0.4);
}
button:active {
transform: scale(0.98);
}
button:disabled {
background: #dae0db;
color: #666;
cursor: not-allowed;
box-shadow: none;
transform: none;
}
/* Bottom Nav */
.bottom-nav {
position: fixed;
bottom: 20px;
left: 50%;
transform: translateX(-50%);
width: 90%;
max-width: 400px;
background: rgb(41, 85, 100);
display: flex;
justify-content: space-around;
align-items: center;
padding: 8px 8px 12px;
box-shadow: 0 10px 40px rgba(0,0,0,0.2);
z-index: 99;
border-radius: 24px;
border: 1px solid rgba(0,0,0,0.05);
}
.nav-btn {
flex: 1;
display: flex;
flex-direction: column;
align-items: center;
justify-content: center;
gap: 4px;
background: transparent;
color: #999;
border: none;
min-height: unset;
padding: 8px 4px;
font-size: 10px;
font-weight: 600;
transition: all 0.2s;
border-radius: 16px;
box-shadow: none !important;
}
.nav-btn svg {
width: 24px;
height: 24px;
fill: none;
stroke: currentColor;
stroke-width: 2;
margin-bottom: 2px;
transition: all 0.2s;
}
.nav-btn.active {
color: var(--bg);
background: rgba(15, 59, 44, 0.05);
}
.nav-btn.active svg {
stroke: var(--bg);
transform: translateY(-2px);
}
.nav-btn .label {
font-size: 10px;
font-weight: 600;
letter-spacing: 0.5px;
}
/* Login Card */
.login-card {
background: white;
width: 100%;
border-radius: 30px;
padding: 40px 24px;
text-align: center;
margin: 20px auto;
box-shadow: 0 20px 60px rgba(0,0,0,0.3);
color: var(--card-text);
}
.logo-placeholder {
width: 80px;
height: 80px;
margin: 0 auto 20px;
filter: drop-shadow(0 4px 10px rgba(0,0,0,0.2));
}
h1.mka-title {
font-size: 24px;
margin-bottom: 5px;
color: var(--bg);
font-weight: 800;
}
.subtitle {
font-size: 13px;
color: var(--muted);
margin-bottom: 30px;
font-weight: 500;
}
.form-group {
margin-bottom: 20px;
text-align: left;
}
.form-group label {
font-size: 13px;
margin-bottom: 8px;
display: block;
color: var(--bg);
font-weight: 600;
margin-left: 4px;
}
.btn-primary {
width: 100%;
padding: 18px;
font-size: 16px;
background: var(--bg);
color: white;
box-shadow: 0 4px 15px rgba(15, 59, 44, 0.3);
}
.btn-primary:hover {
background: var(--bg-light);
}
.btn-qr {
width: 100%;
padding: 16px;
border: 2px solid var(--bg);
background: white;
color: var(--bg);
margin-top: 15px;
box-shadow: none;
}
.btn-qr:hover {
background: #f0f0f0;
transform: translateY(-2px);
}
/* Calculator Styles */
.calculator-detail {
background: linear-gradient(135deg, #f8f9fa, #ffffff);
border-radius: 20px;
padding: 20px;
margin-bottom: 15px;
border: 1px solid #eee;
}
.asset-input-group {
background: white;
border-radius: 16px;
padding: 18px;
margin-bottom: 15px;
border: 1px solid #e0e0e0;
box-shadow: 0 2px 10px rgba(0,0,0,0.02);
}
.asset-label {
display: flex;
align-items: center;
gap: 10px;
margin-bottom: 10px;
color: var(--bg);
font-weight: 700;
font-size: 15px;
}
.asset-label svg {
width: 20px;
height: 20px;
stroke: var(--accent);
stroke-width: 2.5;
}
.input-hint {
font-size: 12px;
color: var(--muted);
margin-top: 6px;
font-style: italic;
}
.nisab-breakdown {
background: #e8f5e9;
border-radius: 20px;
padding: 20px;
margin: 20px 0;
border: 1px solid #c8e6c9;
}
.nisab-item {
display: flex;
justify-content: space-between;
align-items: center;
padding: 10px 0;
border-bottom: 1px dashed rgba(15, 59, 44, 0.2);
}
.nisab-item:last-child {
border-bottom: none;
}
.nisab-item .label {
color: #2e7d32;
font-weight: 600;
font-size: 14px;
}
.nisab-item .value {
font-weight: 700;
color: var(--bg);
font-size: 15px;
}
.calculation-steps {
background: #fff3e0;
border-radius: 20px;
padding: 20px;
margin: 20px 0;
font-size: 14px;
border: 1px solid #ffe0b2;
}
.step {
display: flex;
align-items: center;
gap: 12px;
padding: 8px 0;
color: #555;
}
.step-number {
width: 24px;
height: 24px;
background: var(--accent);
color: var(--bg);
border-radius: 50%;
display: flex;
align-items: center;
justify-content: center;
font-size: 13px;
font-weight: 700;
flex-shrink: 0;
}
.result-box {
background: linear-gradient(135deg, var(--bg), var(--bg-light));
color: white;
padding: 30px;
border-radius: 24px;
text-align: center;
margin-top: 25px;
box-shadow: 0 10px 30px rgba(15, 59, 44, 0.4);
position: relative;
overflow: hidden;
}
.result-box::before {
content: '';
position: absolute;
top: -50%;
left: -50%;
width: 200%;
height: 200%;
background: radial-gradient(circle, rgba(244,180,0,0.1) 0%, transparent 70%);
pointer-events: none;
}
.result-box .label {
font-size: 14px;
opacity: 0.9;
margin-bottom: 8px;
text-transform: uppercase;
letter-spacing: 1px;
}
.result-box .amount {
font-size: 42px;
font-weight: 800;
color: var(--accent);
margin: 10px 0;
text-shadow: 0 2px 10px rgba(0,0,0,0.3);
}
.result-box .detail {
font-size: 13px;
opacity: 0.8;
margin-bottom: 5px;
}
#applyToPayBtn {
width: 100%;
margin-top: 20px;
background: white;
color: var(--bg);
box-shadow: 0 4px 15px rgba(0,0,0,0.2);
}

/* ===== IMPROVED SLIDER STYLES ===== */
.fund-item {
background: #ffffff;
border-radius: 16px;
padding: 20px;
margin-bottom: 16px;
border: 1px solid #0fa2c7;
transition: all 0.2s ease;
}
.fund-item:hover {
border-color: #d0d0d0;
background: #ffffff;
}
.fund-header {
display: flex;
justify-content: space-between;
align-items: center;
margin-bottom: 12px;
}
.fund-name {
font-size: 15px;
font-weight: 700;
color: var(--bg);
}
.fund-percent {
font-size: 14px;
font-weight: 800;
color: var(--bg);
background: rgba(4, 241, 162, 0.1);
padding: 4px 10px;
border-radius: 12px;
min-width: 50px;
text-align: center;
}
.fund-slider-container {
position: relative;
height: 24px; /* Space for thumb */
display: flex;
align-items: center;
}
.slider {
--fill-percent: 0%;
width: 100%;
height: 24px;
-webkit-appearance: none;
appearance: none;
background: transparent;
cursor: pointer;
margin: 0;
z-index: 2;
}
/* The Track (Line) */
.slider::-webkit-slider-runnable-track {
width: 100%;
height: 4px;
background: transparent;
/* Gradient creates the green fill effect */
background-image: linear-gradient(
    to right, 
    var(--slider-fill-bg) 0%, 
    var(--slider-fill-bg) var(--fill-percent), 
    var(--slider-track-bg) var(--fill-percent), 
    var(--slider-track-bg) 100%
);
border-radius: 2px;
}
.slider::-moz-range-track {
width: 100%;
height: 4px;
background: var(--slider-track-bg);
border-radius: 2px;
}
.slider::-moz-range-progress {
height: 4px;
background: var(--slider-fill-bg);
border-radius: 2px;
}
/* The Thumb (Circle) */
.slider::-webkit-slider-thumb {
-webkit-appearance: none;
appearance: none;
width: 20px;
height: 20px;
background: var(--bg);
border: 2px solid #ffffff;
border-radius: 50%;
margin-top: -8px; /* Centers 20px thumb on 4px track within 24px container */
box-shadow: 0 2px 2px rgb(25, 208, 58);
cursor: pointer;
transition: transform 0.1s, box-shadow 0.1s;
}
.slider::-webkit-slider-thumb:hover {
transform: scale(1.1);
box-shadow: 0 4px 10px rgb(2, 239, 53);
}
.slider::-webkit-slider-thumb:active {
transform: scale(1.15);
}
.slider::-moz-range-thumb {
width: 20px;
height: 20px;
background: var(--bg);
border: 2px solid #ffffff;
border-radius: 50%;
box-shadow: 0 2px 2px rgb(238, 73, 2);
cursor: pointer;
}
.fund-amount {
margin-top: 12px;
text-align: right;
font-size: 13px;
color: var(--muted);
font-weight: 600;
}
.fund-amount span {
color: var(--bg);
font-size: 15px;
font-weight: 800;
}

/* History */
.history-list {
list-style: none;
}
.history-list li {
font-size: 14px;
padding: 16px;
border-bottom: 1px solid #f0f0f0;
display: flex;
justify-content: space-between;
align-items: center;
background: #fafafa;
margin-bottom: 8px;
border-radius: 12px;
}
.history-list li:last-child {
border-bottom: none;
}
.history-info strong {
display: block;
color: var(--bg);
font-size: 15px;
}
.history-info small {
color: var(--muted);
font-size: 12px;
}
.history-amount {
text-align: right;
font-weight: 700;
color: var(--success);
}
/* Utilities */
.hidden { display: none !important; }
#loginStatus, #payStatus {
font-size: 14px;
padding: 12px;
text-align: center;
margin-top: 15px;
border-radius: 12px;
font-weight: 600;
}
#loginStatus.error, #payStatus.error { color: var(--error); background: #ffebee; }
#loginStatus.success, #payStatus.success { color: var(--success); background: #e8f5e9; }
/* QR Modal */
.qr-modal {
display: none;
position: fixed;
top: 0;
left: 0;
width: 100%;
height: 100%;
background: rgba(0,0,0,0.9);
z-index: 1000;
flex-direction: column;
align-items: center;
justify-content: center;
backdrop-filter: blur(5px);
}
.qr-modal.active {
display: flex;
animation: fadeIn 0.3s ease;
}
.qr-modal-content {
background: white;
padding: 20px;
border-radius: 24px;
width: 90%;
max-width: 400px;
text-align: center;
position: relative;
}
.qr-modal h3 {
margin-top: 0;
color: var(--bg);
}
#qr-reader-fullscreen {
width: 100%;
border-radius: 16px;
overflow: hidden;
background: #000;
margin: 15px 0;
}
#qr-reader-fullscreen video {
width: 100% !important;
border-radius: 16px;
}
.close-qr-btn {
background: var(--error);
color: white;
border: none;
padding: 10px 20px;
border-radius: 20px;
font-weight: 600;
cursor: pointer;
width: 100%;
min-height: 44px;
}
</style>
</head>
<body>
<!-- Header -->
<header class="app-header">
<div class="header-content">
<div class="logo-mini">
<div class="logo-mini-circle">
<svg viewBox="0 0 24 24" fill="none">
<path d="M12 2C8 6 4 8 4 12c0 4 4 8 8 10 4-2 8-6 8-10 0-4-4-6-8-10z" fill="#0f3b2c"/>
</svg>
</div>
<div class="logo-mini-text">
MAAL <small>Zakat App</small>
</div>
</div>
<span class="page-title-badge" id="currentPageTitle">Home</span>
<div class="user-header-mini" id="userInfoSection" style="display: none;">
<span class="name" id="headerUserName">Member</span>
<button class="logout-btn" id="logoutBtn">
<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
<path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"></path>
<polyline points="16 17 21 12 16 7"></polyline>
<line x1="21" y1="12" x2="9" y2="12"></line>
</svg>
Exit
</button>
</div>
</div>
</header>
<main class="container" id="mainContainer">
<!-- LOGIN PAGE -->
<div id="loginPage" class="page active">
<div class="login-card">
<div class="logo-placeholder">
<svg viewBox="0 0 64 64">
<defs>
<linearGradient id="ugandaFlag" y1="0" y2="1">
<stop offset="0" stop-color="#000"/>
<stop offset="0.333" stop-color="#000"/>
<stop offset="0.333" stop-color="#FFD700"/>
<stop offset="0.666" stop-color="#FFD700"/>
<stop offset="0.666" stop-color="#FF0000"/>
<stop offset="1" stop-color="#FF0000"/>
</linearGradient>
</defs>
<circle cx="32" cy="32" r="32" fill="url(#ugandaFlag)" />
<path d="M32 14 L36 32 L28 32 Z" fill="white" />
</svg>
</div>
<h1 class="mka-title">MKA - UGANDA</h1>
<p class="subtitle">AHMADIYYA MUSLIM COMMUNITY</p>
<div class="form-group">
<label>Full Name</label>
<input id="loginName" type="text" placeholder="e.g. Ahmed Ibrahim" />
</div>
<div class="form-group">
<label>ID Number</label>
<input id="loginId" type="password" placeholder="Enter your Member ID" />
</div>
<button id="loginBtn" class="btn-primary">Secure Login</button>
<div style="margin: 25px 0; color: #ccc; font-size: 12px; position: relative;">
<span style="background:white; padding:0 10px; position:relative; z-index:1;">OR</span>
<div style="position:absolute; top:50%; left:0; width:100%; height:1px; background:#eee; z-index:0;"></div>
</div>
<button class="btn-qr" id="openQrBtn">
<svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
<rect x="7" y="7" width="10" height="10" rx="1"></rect>
<path d="M3 3h6v6H3zM15 15h6v6h-6zM3 15h6v6H3zM15 3h6v6h-6z"></path>
</svg>
Scan Member Card
</button>
<div id="loginStatus"></div>
<div class="footer" style="margin-top: 30px; font-size: 11px; color: #999;">
¬© 2025 Majlis Khuddamul Ahmadiyya Uganda
</div>
</div>
</div>
<!-- HOME PAGE -->
<div id="homePage" class="page">
<div class="card">
<h2>üè† Zakat Teachings</h2>
<p style="margin-bottom: 15px; color: #555;">Assalamu Alaikum! Learn about the beauty of Zakat.</p>
<div class="teachings-carousel" id="teachingsCarousel">
<!-- Teaching slides injected by JS -->
</div>
<div class="slide-indicators" id="slideIndicators"></div>
<div class="slide-timer">
<div class="timer-bar" id="timerBar"></div>
</div>
</div>
</div>
<!-- CALCULATOR PAGE -->
<div id="calcPage" class="page">
<div class="card">
<h2>üßÆ Zakat Calculator</h2>
<p style="color:#666; margin-bottom:20px;">Calculate your Zakat with detailed breakdown</p>
<div class="nisab-breakdown">
<h3 style="margin-top: 0; font-size: 16px;">üìä Current Nisab Values</h3>
<div class="nisab-item">
<span class="label">Gold Nisab (87.48g)</span>
<span class="value" id="goldNisabValue">UGX 7,435,800</span>
</div>
<div class="nisab-item">
<span class="label">Silver Nisab (612.36g)</span>
<span class="value" id="silverNisabValue">UGX 3,367,980</span>
</div>
<div class="nisab-item">
<span class="label">‚úÖ Applicable Nisab (Lower)</span>
<span class="value" style="color: var(--accent);" id="applicableNisab">UGX 3,367,980</span>
</div>
</div>
<div class="asset-input-group">
<div class="asset-label">
<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
<rect x="2" y="6" width="20" height="12" rx="2"></rect>
<circle cx="12" cy="12" r="2"></circle>
</svg>
Cash & Bank Balance
</div>
<input type="number" id="cashAmount" placeholder="Enter amount (UGX)" min="0" value="0" step="1000">
<div class="input-hint">Includes savings, current accounts, and cash in hand</div>
</div>
<div class="asset-input-group">
<div class="asset-label">
<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
<circle cx="12" cy="12" r="10"></circle>
<path d="M12 6v6l4 2"></path>
</svg>
Gold (grams)
</div>
<input type="number" id="goldAmount" placeholder="Enter weight in grams" min="0" value="0" step="0.1">
<div class="input-hint">1 tola = 11.664 grams | Current price: UGX 85,000/g</div>
</div>
<div class="asset-input-group">
<div class="asset-label">
<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
<circle cx="12" cy="12" r="10"></circle>
<path d="M12 6v6l4 2"></path>
</svg>
Silver (grams)
</div>
<input type="number" id="silverAmount" placeholder="Enter weight in grams" min="0" value="0" step="0.1">
<div class="input-hint">1 tola = 11.664 grams | Current price: UGX 5,500/g</div>
</div>
<div class="asset-input-group">
<div class="asset-label">
<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
<rect x="2" y="7" width="20" height="14" rx="2"></rect>
<path d="M16 3L20 7 16 11"></path>
</svg>
Business Inventory
</div>
<input type="number" id="inventoryAmount" placeholder="Enter value (UGX)" min="0" value="0" step="1000">
<div class="input-hint">Stock in trade, goods for sale</div>
</div>
<div class="calculation-steps" id="calculationSteps">
<div class="step">
<span class="step-number">1</span>
<span>Total Wealth = Cash + Gold + Silver + Inventory</span>
</div>
<div class="step">
<span class="step-number">2</span>
<span>Compare with Nisab (lower of gold/silver value)</span>
</div>
<div class="step">
<span class="step-number">3</span>
<span>If wealth ‚â• Nisab, Zakat = 2.5% of total wealth</span>
</div>
</div>
<div class="result-box">
<div class="label">Your Zakat Due</div>
<div class="amount" id="zakatResult">UGX 0</div>
<div class="detail" id="zakatDetail">Total Wealth: UGX 0</div>
<div class="detail" id="zakatStatus"></div>
<button id="applyToPayBtn" style="width: 100%; margin-top: 15px; background: white; color: var(--bg);">Apply to Payment</button>
</div>
</div>
</div>
<!-- PAY ZAKAT PAGE -->
<div id="payPage" class="page">
<div class="card">
<h2>üí≥ Pay Zakat</h2>
<div style="margin-bottom: 20px;">
<label style="display: block; margin-bottom: 10px; font-weight:600; color:var(--bg);">Total Amount (UGX)</label>
<input id="totalAmount" type="number" min="0" step="1000" value="0" />
</div>
<div id="fundsContainer" style="margin-bottom:20px;">Loading funds...</div>
<div id="totalStatus" style="text-align:center; margin-bottom:15px; font-weight:600; color:#666;"></div>
<button id="payNowBtn" class="pay-now" style="width: 100%; margin: 15px 0;" disabled>üí≥ Pay Now</button>
<button id="confirmPayBtn" class="confirm-btn" style="width: 100%; background: var(--bg); color: white;" disabled>‚úÖ Save Allocation</button>
<div id="payStatus"></div>
</div>
</div>
<!-- HISTORY PAGE -->
<div id="historyPage" class="page">
<div class="card">
<h2>üìú Payment History</h2>
<div id="historyContainer" style="margin-top:20px;">Loading history...</div>
</div>
</div>
</main>
<!-- Bottom Navigation -->
<nav id="bottomNav" class="bottom-nav">
<button id="navHome" class="nav-btn">
<svg viewBox="0 0 24 24">
<path d="M3 10.5L12 4l9 6.5V20a1 1 0 0 1-1 1h-5v-6H9v6H4a1 1 0 0 1-1-1V10.5z"/>
</svg>
<span class="label">Home</span>
</button>
<button id="navCalc" class="nav-btn">
<svg viewBox="0 0 24 24">
<rect x="6" y="3" width="12" height="18" rx="2"/>
<path d="M9 7h6M9 11h6M9 15h4"/>
</svg>
<span class="label">Calculator</span>
</button>
<button id="navPay" class="nav-btn">
<svg viewBox="0 0 24 24">
<path d="M21 12v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-6"/>
<path d="M7 10V6a5 5 0 0 1 10 0v4"/>
</svg>
<span class="label">Pay Zakat</span>
</button>
<button id="navHistory" class="nav-btn">
<svg viewBox="0 0 24 24">
<circle cx="12" cy="12" r="10"/>
<polyline points="12 6 12 12 16 14"/>
</svg>
<span class="label">History</span>
</button>
</nav>
<!-- QR Scanner Modal -->
<div id="qrModal" class="qr-modal">
<div class="qr-modal-content">
<h3>Scan Member Card</h3>
<p style="font-size:13px; color:#666; margin-bottom:10px;">Position the QR code within the frame</p>
<div id="qr-reader-fullscreen"></div>
<button class="close-qr-btn" id="closeQrBtn">Close Camera</button>
</div>
</div>
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<script src="https://unpkg.com/html5-qrcode"></html5-qrcode></script>
<script>
const SUPABASE_URL = "https://pqrsljahrnjgkadflbmr.supabase.co";
const SUPABASE_ANON_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InBxcnNsamFocm5qZ2thZGZsYm1yIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzA1NTg0NTYsImV4cCI6MjA4NjEzNDQ1Nn0.egED0C2iRp6j3Xp4ldgrdI0GBep2J7VUR52rBbzsVdo";
const { createClient } = window.supabase;
const supabaseClient = createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
let funds = [];
let percentages = {};
let currentMemberId = localStorage.getItem("currentMemberId") || null;
let currentUserUuid = localStorage.getItem("currentUserUuid") || null;
let currentUserEmail = localStorage.getItem("currentUserEmail") || null;
let currentUserName = localStorage.getItem("currentUserName") || null;
let qrScannerInstance = null;
// Auto-rotating teachings variables
let currentSlide = 0;
let slideInterval;
let timerInterval;
let timerProgress = 0;
const SLIDE_DURATION = 8000;
const teachings = [
{
icon: 'üìñ',
title: 'Hadith on Zakat',
content: '<div class="hadith-text">"Whoever gives charity equal to a date from good earnings ‚Äì and Allah accepts only what is good ‚Äì Allah takes it in His right hand and nurtures it for its owner as one of you nurtures his foal, until it becomes like a mountain."</div>',
reference: 'Sahih Bukhari & Sahih Muslim'
},
{
icon: 'üéôÔ∏è',
title: 'Huzur (aba) on Zakat',
content: '<p>"Zakat is not just a financial obligation; it is a spiritual purification. When you pay Zakat with sincerity, it cleanses your wealth and your soul. It establishes economic justice in society and strengthens the bonds of brotherhood."</p>',
reference: 'Hazrat Mirza Masroor Ahmad (aba) - Friday Sermon'
},
{
icon: '‚ú®',
title: 'Quranic Promise',
content: '<p>Allah says in the Holy Quran:</p><div class="hadith-text">"The example of those who spend their wealth in the way of Allah is like a seed of grain which grows seven spikes; in each spike is a hundred grains. And Allah multiplies His reward for whom He wills."</div>',
reference: 'Surah Al-Baqarah (2:261)'
},
{
icon: 'ü§≤',
title: 'Benefits of Zakat',
content: '<ul style="margin-left: 20px; color:#555;"><li>Purifies wealth and soul</li><li>Increases blessings in wealth</li><li>Protects from calamities</li><li>Helps the needy in community</li><li>Brings Allah\'s pleasure</li><li>Opens doors of mercy</li></ul>',
reference: 'Teachings of Islam'
},
{
icon: 'üìú',
title: 'Who Deserves Zakat',
content: '<p>The Quran specifies eight categories:</p><ul style="margin-left: 20px; color:#555;"><li>The poor (Fuqara)</li><li>The needy (Masakin)</li><li>Zakat collectors</li><li>Those whose hearts are to be reconciled</li><li>Freeing captives</li><li>Those in debt</li><li>In the way of Allah</li><li>The wayfarer</li></ul>',
reference: 'Surah At-Tawbah (9:60)'
},
{
icon: 'üíé',
title: 'Wisdom of Zakat',
content: '<p>Hazrat Mirza Ghulam Ahmad (as) said:</p><div class="hadith-text">"Zakat is a means of developing sympathy and compassion for the poor. It removes arrogance from the heart and creates humility. It reminds us that all wealth belongs to Allah."</div>',
reference: 'Malfuzat - Volume 5'
},
{
icon: '‚≠ê',
title: 'Reward Multiplied',
content: '<p>The Prophet Muhammad (Ô∑∫) said:</p><div class="hadith-text">"Charity does not decrease wealth. No one forgives another except that Allah increases his honor. And no one humbles himself for the sake of Allah except that Allah raises his status."</div>',
reference: 'Sahih Muslim'
},
{
icon: 'üåô',
title: 'Zakat in Ramadan',
content: '<p>Ibn Abbas (ra) reported: The Messenger of Allah (Ô∑∫) was the most generous of people, and he was even more generous during Ramadan when he met with Jibril. He would give charity more freely than the blowing wind.</p>',
reference: 'Sahih Bukhari'
}
];
// Initialize teachings carousel
function initTeachingsCarousel() {
const carousel = document.getElementById('teachingsCarousel');
const indicators = document.getElementById('slideIndicators');
if (!carousel) return;
let slidesHtml = '';
teachings.forEach((teaching, index) => {
slidesHtml += `
<div class="teaching-slide ${index === 0 ? 'active-slide' : ''}" data-slide="${index}">
<h3><span>${teaching.icon}</span> ${teaching.title}</h3>
<div class="teaching-content">${teaching.content}</div>
<div class="reference">‚Äî ${teaching.reference}</div>
</div>`;
});
carousel.innerHTML = slidesHtml;
let indicatorsHtml = '';
teachings.forEach((_, index) => {
indicatorsHtml += `<div class="indicator ${index === 0 ? 'active' : ''}" onclick="goToSlide(${index})"></div>`;
});
indicators.innerHTML = indicatorsHtml;
startSlideRotation();
}
function startSlideRotation() {
if (slideInterval) clearInterval(slideInterval);
if (timerInterval) clearInterval(timerInterval);
timerProgress = 0;
updateTimerBar();
slideInterval = setInterval(() => { nextSlide(); }, SLIDE_DURATION);
timerInterval = setInterval(() => {
timerProgress = (timerProgress + 100) % SLIDE_DURATION;
updateTimerBar();
}, 100);
}
function updateTimerBar() {
const timerBar = document.getElementById('timerBar');
if (timerBar) {
const progress = (timerProgress / SLIDE_DURATION) * 100;
timerBar.style.width = `${progress}%`;
}
}
window.goToSlide = function(index) {
document.querySelectorAll('.teaching-slide').forEach(slide => {
slide.classList.remove('active-slide');
});
document.querySelector(`.teaching-slide[data-slide="${index}"]`).classList.add('active-slide');
document.querySelectorAll('.indicator').forEach((ind, i) => {
ind.classList.toggle('active', i === index);
});
currentSlide = index;
timerProgress = 0;
updateTimerBar();
};
function nextSlide() {
currentSlide = (currentSlide + 1) % teachings.length;
goToSlide(currentSlide);
}
// Navigation
function showPage(pageId){
document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
const page = document.getElementById(pageId);
if(page) page.classList.add('active');
const pageTitles = {
'homePage': 'Home',
'calcPage': 'Calculator',
'payPage': 'Pay',
'historyPage': 'History',
'loginPage': 'Login'
};
document.getElementById('currentPageTitle').textContent = pageTitles[pageId] || 'Home';
const userInfoSection = document.getElementById('userInfoSection');
if(pageId === 'loginPage' || !currentMemberId) {
userInfoSection.style.display = 'none';
} else {
userInfoSection.style.display = 'flex';
document.getElementById('headerUserName').textContent = currentUserName || 'Member';
}
const bottomNav = document.getElementById("bottomNav");
if(pageId === "loginPage"){
bottomNav.classList.add("hidden");
stopQrScanner();
} else {
bottomNav.classList.remove("hidden");
stopQrScanner();
}
document.querySelectorAll('.bottom-nav .nav-btn').forEach(b => b.classList.remove('active'));
switch(pageId){
case 'homePage':
document.getElementById('navHome').classList.add('active');
initTeachingsCarousel();
break;
case 'calcPage': document.getElementById('navCalc').classList.add('active'); break;
case 'payPage': document.getElementById('navPay').classList.add('active'); fetchFunds(); break;
case 'historyPage': document.getElementById('navHistory').classList.add('active'); fetchHistory(); break;
}
document.getElementById('mainContainer').scrollTop = 0;
}
// Event Listeners
document.getElementById("navHome").addEventListener("click", ()=> showPage("homePage"));
document.getElementById("navCalc").addEventListener("click", ()=> showPage("calcPage"));
document.getElementById("navPay").addEventListener("click", ()=> showPage("payPage"));
document.getElementById("navHistory").addEventListener("click", ()=> showPage("historyPage"));
document.getElementById("logoutBtn").addEventListener("click", ()=>{
localStorage.clear();
currentMemberId = null;
currentUserUuid = null;
currentUserEmail = null;
currentUserName = null;
showPage("loginPage");
});
// Login
async function loginUser(name, idNumber){
const statusEl = document.getElementById("loginStatus");
statusEl.innerText = "Checking credentials...";
statusEl.className = "";
try {
const { data, error } = await supabaseClient
.from("members")
.select("member_id, user_id, full_name, email")
.eq("full_name", name)
.eq("member_id", idNumber)
.single();
if(error || !data){
statusEl.innerText = "‚ùå Invalid credentials. Please check your ID.";
statusEl.className = "error";
return;
}
currentMemberId = data.member_id;
currentUserUuid = data.user_id || null;
currentUserName = data.full_name;
currentUserEmail = data.email || `${name.toLowerCase().replace(' ', '.')}@mkau.org`;
localStorage.setItem("currentMemberId", currentMemberId);
localStorage.setItem("currentUserUuid", currentUserUuid);
localStorage.setItem("currentUserName", currentUserName);
localStorage.setItem("currentUserEmail", currentUserEmail);
statusEl.innerText = "‚úÖ Welcome " + data.full_name;
statusEl.className = "success";
setTimeout(() => showPage("homePage"), 1000);
} catch(e){
statusEl.innerText = "‚ùå Connection error.";
statusEl.className = "error";
}
}
document.getElementById("loginBtn").addEventListener("click", ()=>{
const name = document.getElementById("loginName").value.trim();
const idNumber = document.getElementById("loginId").value.trim();
if(!name || !idNumber){
const statusEl = document.getElementById("loginStatus");
statusEl.innerText = "‚ö†Ô∏è Please enter both name and ID.";
statusEl.className = "error";
return;
}
loginUser(name, idNumber);
});
// QR Scanner Modal Logic
const qrModal = document.getElementById('qrModal');
const openQrBtn = document.getElementById('openQrBtn');
const closeQrBtn = document.getElementById('closeQrBtn');
openQrBtn.addEventListener('click', () => {
qrModal.classList.add('active');
startQrScanner();
});
closeQrBtn.addEventListener('click', () => {
qrModal.classList.remove('active');
stopQrScanner();
});
qrModal.addEventListener('click', (e) => {
if (e.target === qrModal) {
qrModal.classList.remove('active');
stopQrScanner();
}
});
function startQrScanner(){
const qrReaderEl = document.getElementById("qr-reader-fullscreen");
if(!qrReaderEl) return;
if(qrScannerInstance) {
stopQrScanner();
}
qrScannerInstance = new Html5Qrcode("qr-reader-fullscreen");
const config = {
fps: 10,
qrbox: { width: 250, height: 250 },
aspectRatio: 1.0
};
qrScannerInstance.start(
{ facingMode: "environment" },
config,
qrMessage => {
document.getElementById("loginId").value = qrMessage;
const statusEl = document.getElementById("loginStatus");
statusEl.innerText = "‚úÖ QR Scanned Successfully!";
statusEl.className = "success";
qrModal.classList.remove('active');
stopQrScanner();
},
error => {}
).catch(err => {
qrReaderEl.innerHTML = "<div style='color:white; padding:20px;'>Camera unavailable. Please allow permissions.</div>";
qrScannerInstance = null;
});
}
function stopQrScanner(){
if(!qrScannerInstance) return;
qrScannerInstance.stop().then(() => {
qrScannerInstance.clear();
qrScannerInstance = null;
}).catch(()=>{});
}
// Calculator Logic
let goldPricePerGram = 85000;
let silverPricePerGram = 5500;
const GOLD_NISAB_GRAMS = 87.48;
const SILVER_NISAB_GRAMS = 612.36;
function updateNisabDisplay() {
const goldNisab = goldPricePerGram * GOLD_NISAB_GRAMS;
const silverNisab = silverPricePerGram * SILVER_NISAB_GRAMS;
const applicableNisab = Math.min(goldNisab, silverNisab);
document.getElementById('goldNisabValue').textContent = `UGX ${Math.round(goldNisab).toLocaleString()}`;
document.getElementById('silverNisabValue').textContent = `UGX ${Math.round(silverNisab).toLocaleString()}`;
document.getElementById('applicableNisab').textContent = `UGX ${Math.round(applicableNisab).toLocaleString()}`;
return applicableNisab;
}
function calculateZakat() {
const cash = parseFloat(document.getElementById('cashAmount').value) || 0;
const gold = parseFloat(document.getElementById('goldAmount').value) || 0;
const silver = parseFloat(document.getElementById('silverAmount').value) || 0;
const inventory = parseFloat(document.getElementById('inventoryAmount').value) || 0;
const goldValue = gold * goldPricePerGram;
const silverValue = silver * silverPricePerGram;
const totalWealth = cash + goldValue + silverValue + inventory;
const nisab = updateNisabDisplay();
let zakatDue = 0;
let status = '';
if (totalWealth >= nisab) {
zakatDue = totalWealth * 0.025;
status = `‚úÖ Eligible for Zakat`;
} else {
status = `‚ö†Ô∏è Below Nisab threshold`;
}
document.getElementById('zakatResult').textContent = `UGX ${Math.round(zakatDue).toLocaleString()}`;
document.getElementById('zakatDetail').textContent = `Total Wealth: UGX ${Math.round(totalWealth).toLocaleString()}`;
document.getElementById('zakatStatus').textContent = status;
return Math.round(zakatDue);
}
['cashAmount', 'goldAmount', 'silverAmount', 'inventoryAmount'].forEach(id => {
document.getElementById(id).addEventListener('input', calculateZakat);
});
document.getElementById('applyToPayBtn').addEventListener('click', ()=>{
const zakatAmount = calculateZakat();
if (zakatAmount > 0) {
document.getElementById('totalAmount').value = zakatAmount;
showPage('payPage');
updateTotals();
} else {
alert('No Zakat due. Your wealth is below Nisab.');
}
});
calculateZakat();
// Funds and allocations
async function fetchFunds(){
const container = document.getElementById("fundsContainer");
container.innerHTML = "<div style='text-align:center; padding:20px; color:#666;'>Loading funds...</div>";
try {
const { data, error } = await supabaseClient
.from("zakat_funds")
.select("*")
.order("display_order", { ascending: true });
if(error) throw error;
funds = data || [];
renderFunds();
} catch(e){
container.innerHTML = "<div style='text-align:center; color:var(--error);'>Error loading funds.</div>";
}
}
// ===== IMPROVED SLIDER BACKGROUND UPDATE =====
function updateSliderBackground(slider) {
const min = parseFloat(slider.min) || 0;
const max = parseFloat(slider.max) || 100;
const value = parseFloat(slider.value) || 0;
const percentage = ((value - min) / (max - min)) * 100;
// Update CSS Variable for gradient
slider.style.setProperty('--fill-percent', percentage + '%');
}
// Initialize all sliders with background
function initializeSliderBackgrounds() {
document.querySelectorAll('.slider').forEach(slider => {
updateSliderBackground(slider);
slider.addEventListener('input', () => updateSliderBackground(slider));
slider.addEventListener('change', () => updateSliderBackground(slider));
});
}
function renderFunds(){
const container = document.getElementById("fundsContainer");
if(!funds.length){
container.innerHTML = "<div class='card'>No funds found.</div>";
return;
}
percentages = {};
let html = "";
funds.forEach(fund => {
percentages[fund.id] = 0;
html += `
<div class="fund-item">
<div class="fund-header">
<div class="fund-name">${escapeHtml(fund.name)}</div>
<div class="fund-percent" id="percent-${fund.id}">0%</div>
</div>
<div class="fund-slider-container">
<input type="range" min="0" max="100" value="0" class="slider" id="slider-${fund.id}" oninput="handleSlider(${fund.id}, this.value)" />
</div>
<div class="fund-amount">
UGX <span id="amount-${fund.id}">0</span>
</div>
</div>`;
});
container.innerHTML = html;
// Initialize slider backgrounds after rendering
setTimeout(() => initializeSliderBackgrounds(), 100);
updateTotals();
}
window.handleSlider = function(id, value){
value = parseInt(value) || 0;
percentages[id] = value;
let total = Object.values(percentages).reduce((a,b)=>a+(b||0),0);
if(total > 100){
percentages[id] -= (total - 100);
document.getElementById(`slider-${id}`).value = percentages[id];
}
Object.keys(percentages).forEach(key => {
const p = document.getElementById(`percent-${key}`);
if(p) p.innerText = percentages[key] + "%";
// Update slider background for all sliders
const slider = document.getElementById(`slider-${key}`);
if(slider) updateSliderBackground(slider);
});
updateTotals();
};
function updateTotals(){
const totalAmount = parseFloat(document.getElementById("totalAmount").value) || 0;
const totalPercent = Object.values(percentages).reduce((a,b)=>a+(b||0),0);
funds.forEach(fund => {
const percent = percentages[fund.id] || 0;
const amount = Math.round(totalAmount * percent / 100);
const el = document.getElementById(`amount-${fund.id}`);
if(el) el.innerText = amount.toLocaleString();
});
const status = document.getElementById("totalStatus");
const confirmBtn = document.getElementById("confirmPayBtn");
const payNowBtn = document.getElementById("payNowBtn");
if(status) {
if(totalPercent === 100 && totalAmount > 0){
status.innerHTML = `‚úÖ Total Allocation: 100%`;
status.style.color = "var(--success)";
if(confirmBtn) confirmBtn.disabled = false;
if(payNowBtn) payNowBtn.disabled = false;
} else {
status.innerHTML = `‚ö†Ô∏è Total: ${totalPercent}% (Must be 100%)`;
status.style.color = totalPercent > 100 ? "var(--error)" : "#666";
if(confirmBtn) confirmBtn.disabled = true;
if(payNowBtn) payNowBtn.disabled = true;
}
}
}
document.getElementById("totalAmount")?.addEventListener("input", updateTotals);
// Payment
document.getElementById("payNowBtn")?.addEventListener("click", async ()=>{
if(!currentMemberId){
document.getElementById("payStatus").innerText = "‚ùå Login required.";
return;
}
document.getElementById("payStatus").innerText = "Processing payment...";
document.getElementById("payStatus").className = "";
setTimeout(async () => {
await saveAllocationsAfterPayment();
}, 1000);
});
async function saveAllocationsAfterPayment(){
const totalAmount = parseFloat(document.getElementById("totalAmount").value) || 0;
const allocations = funds.map(fund => ({
fund_id: fund.id,
member_id: currentMemberId,
user_id: currentUserUuid,
percent: percentages[fund.id] || 0,
amount: (totalAmount * (percentages[fund.id] || 0) / 100).toFixed(2),
created_at: new Date().toISOString()
})).filter(a => parseFloat(a.amount) > 0);
try {
const { error } = await supabaseClient
.from("zakat_allocations")
.insert(allocations);
if(error) throw error;
const statusEl = document.getElementById("payStatus");
statusEl.innerText = "‚úÖ Payment saved successfully!";
statusEl.className = "success";
Object.keys(percentages).forEach(key => {
percentages[key] = 0;
const s = document.getElementById(`slider-${key}`);
if(s) s.value = 0;
const p = document.getElementById(`percent-${key}`);
if(p) p.innerText = "0%";
});
document.getElementById("totalAmount").value = "0";
updateTotals();
fetchHistory();
} catch(e){
const statusEl = document.getElementById("payStatus");
statusEl.innerText = "‚ùå Error saving allocation.";
statusEl.className = "error";
}
}
document.getElementById("confirmPayBtn")?.addEventListener("click", async ()=>{
if(!currentMemberId){
document.getElementById("payStatus").innerText = "‚ùå Login required.";
return;
}
await saveAllocationsAfterPayment();
});
// History
async function fetchHistory(){
const container = document.getElementById("historyContainer");
container.innerHTML = "<div style='text-align:center; padding:20px;'>Loading...</div>";
if(!currentMemberId){
container.innerHTML = "<div style='text-align:center; color:var(--error);'>‚ùå Login to view history.</div>";
return;
}
try {
const { data, error } = await supabaseClient
.from("zakat_allocations")
.select("id, fund_id, percent, amount, created_at")
.eq("member_id", currentMemberId)
.order("created_at", { ascending: false })
.limit(20);
if(error) throw error;
if(!data || !data.length){
container.innerHTML = "<div style='text-align:center; color:#666; padding:20px;'>No payments recorded yet.</div>";
return;
}
let html = "<ul class='history-list'>";
data.forEach(record => {
const fund = funds.find(f => f.id === record.fund_id);
const fundName = fund ? fund.name : "Fund";
html += `
<li>
<div class="history-info">
<strong>${escapeHtml(fundName)}</strong>
<small>${new Date(record.created_at).toLocaleDateString()}</small>
</div>
<div class="history-amount">
UGX ${Number(record.amount).toLocaleString()}
<div style="font-size:11px; color:#999; font-weight:400;">${record.percent}%</div>
</div>
</li>`;
});
html += "</ul>";
container.innerHTML = html;
} catch(e){
container.innerHTML = "<div style='text-align:center; color:var(--error);'>‚ùå Error loading history.</div>";
}
}
function escapeHtml(str){
return String(str || '').replace(/[&<>"']/g, function(m){
return {'&': '&amp;', '<': '&lt;', '>': '&gt;', '"': '&quot;', "'": '&#39;'}[m];
});
}
// Scrollbar Logic (Green only when scrolling)
const mainContainer = document.getElementById('mainContainer');
let isScrolling;
mainContainer.addEventListener('scroll', () => {
mainContainer.classList.add('scrolling-active');
clearTimeout(isScrolling);
isScrolling = setTimeout(() => {
mainContainer.classList.remove('scrolling-active');
}, 800);
}, false);
// Initialize
window.addEventListener("load", ()=>{
if(currentMemberId){
showPage("homePage");
} else {
showPage("loginPage");
}
fetchFunds();
});
</script>
</body>
</html>
